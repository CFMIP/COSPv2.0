.SUFFIXES : .F .f .c .o .a .f90 .f95 .F90
########################################################################
# Makefile for cosp_test_v1.5 driver 
########################################################################
# Intel (ifort)
F90      = ifort
F90FLAGS = -fpp -O3 -pg
F90_LIB  = /usr/local/ifort
# Portland Group (pgf90)
#F90      = pgf90
#F90FLAGS = -Mpreprocess -O0 -g
#F90_LIB  = /usr/local/pgf90
# Gfortran (gfortran)
#F90      = gfortran
#F90FLAGS = -cpp -O3 -fbacktrace -fbounds-check
#F90_LIB  = /usr/local/gfortran

INC = /usr/local/include
LIB = /usr/local/lib

NCDF_INC    = $(F90_LIB)/include
NCDF_LIB    = $(F90_LIB)/lib
CMOR_INC    = $(F90_LIB)/include
CMOR_LIB    = $(F90_LIB)/lib
UDUNITS_LIB = $(F90_LIB)/lib
UDUNITS_INC = $(F90_LIB)/include
UUID_LIB    = $(F90_LIB)/lib
UUID_INC    = $(F90_LIB)/include

# COSP source directory
SRC_F90  = /home/dswales/Projects/COSP/COSPv2.0/src
OBJ_PATH = ${SRC_F90}/obj

# COSPv1.4 model interface directory
COSP_INTERFACE_F90 = /home/dswales/Projects/COSP/COSPv2.0/cosp-interface
PROG = cosp_test_v1.5

# Object files
OBJS =  $(OBJ_PATH)/cosp_kinds.o  $(OBJ_PATH)/cosp_constants.o                \
	$(OBJ_PATH)/cosp_cloudsat_interface.o $(OBJ_PATH)/cosp_config.o       \
        $(OBJ_PATH)/prec_scops.o $(OBJ_PATH)/cosp.o $(OBJ_PATH)/cosp_stats.o  \
	$(OBJ_PATH)/quickbeam.o $(OBJ_PATH)/cosp_optics.o                     \
	$(OBJ_PATH)/array_lib.o $(OBJ_PATH)/quickbeam_optics.o                \
	$(OBJ_PATH)/math_lib.o $(OBJ_PATH)/optics_lib.o $(OBJ_PATH)/parasol.o \
	$(OBJ_PATH)/lidar_simulator.o $(OBJ_PATH)/icarus.o                    \
	$(OBJ_PATH)/cosp_calipso_interface.o $(OBJ_PATH)/cosp_errorHandling.o \
	$(OBJ_PATH)/cosp_isccp_interface.o $(OBJ_PATH)/cosp_misr_interface.o  \
	$(OBJ_PATH)/MISR_simulator.o $(OBJ_PATH)/cosp_modis_interface.o       \
	$(OBJ_PATH)/modis_simulator.o $(OBJ_PATH)/cosp_rttov_interface.o      \
	$(OBJ_PATH)/cosp_rttovSTUB.o $(OBJ_PATH)/mrgrnk.o                     \
	$(OBJ_PATH)/cosp_parasol_interface.o mo_rng.o scops.o cosp_utils.o    \
	cosp_interface_v1p5.o cosp_io.o

all: $(PROG)
	mv *.mod *.o obj/

$(PROG): $(OBJS)
	$(F90) $(F90FLAGS) $(PROG).f90 $(OBJS) \
	-L${CMOR_LIB} -L. -lcmor -I$(CMOR_INC) \
	-I$(NCDF_INC) -L${NCDF_LIB} -lnetcdff -lnetcdf -L{LIB} -lnetcdf \
	-I$(OBJ_PATH) \
	-L${UDUNITS_LIB} -Wl,-rpath=${UDUNITS_LIB} -ludunits2 -lexpat -I${UDUNITS_INC} \
	-L${UUID_LIB} -Wl,-rpath=${UUID_LIB} -luuid -I$(UUID_INC) \
	-o $(PROG)

$(PROG).o     	          : $(OBJ_PATH)/cosp_config.o $(OBJ_PATH)/cosp.o cosp_io.o   \
			    cosp_interface_v1p5.o
cosp_io.o  	          : $(OBJ_PATH)/cosp_kinds.o $(OBJ_PATH)/cosp_config.o       \
			    cosp_interface_v1p5.o cosp_interface_v1p4.o              \
                            $(OBJ_PATH)/cosp_rttovSTUB.o $(OBJ_PATH)/cosp.o          \
			    $(OBJ_PATH)/cosp_parasol_interface.o
cosp_interface_v1p5.o     : $(OBJ_PATH)/cosp_kinds.o cosp_utils.o $(OBJ_PATH)/cosp.o \
			    $(OBJ_PATH)/cosp_constants.o $(OBJ_PATH)/cosp_config.o   \
                            $(OBJ_PATH)/cosp_optics.o $(OBJ_PATH)/quickbeam.o        \
			    $(OBJ_PATH)/quickbeam_optics.o mo_rng.o scops.o          \
			    $(OBJ_PATH)/quickbeam_optics.o $(OBJ_PATH)/prec_scops.o 
cosp_utils.o              : $(OBJ_PATH)/cosp_kinds.o $(OBJ_PATH)/cosp_config.o
scops.o                   : $(OBJ_PATH)/cosp_kinds.o mo_rng.o                        \
			    $(OBJ_PATH)/cosp_errorHandling.o
mo_rng.o                  : $(OBJ_PATH)/cosp_kinds.o

clean_objs:
	rm -f $(OBJ_PATH) *.mod *.o

clean_all:	
	rm -f $(PROG) $(OBJ_PATH)/*.o $(OBJ_PATH)/*.mod *.o *.mod fort.*

clean:	
	rm -f $(PROG) *.o *.mod fort.*

cosp:
	make -C ../../src/ install

cosp_io.o: cosp_io.f90
	$(F90) $(F90FLAGS) -c -I$(CMOR_INC) -I$(OBJ_PATH) $<

mo_rng.o : $(SRC_F90)/rng/mo_rng.f90
	$(F90) $(F90FLAGS) -c -I $(OBJ_PATH) $<

scops.o : $(SRC_F90)/subcol/scops.f90
	$(F90) $(F90FLAGS) -c -I $(OBJ_PATH) $<

cosp_utils.o :  $(SRC_F90)/optics/cosp_utils.f90
	$(F90) $(F90FLAGS) -c -I $(OBJ_PATH) $<

cosp_interface_v1p5.o : $(COSP_INTERFACE_F90)/cosp_interface_v1p5.f90
	$(F90) $(F90FLAGS) -c -I $(OBJ_PATH) $<

cosp_interface_v1p4.o : $(COSP_INTERFACE_F90)/cosp_interface_v1p4.f90
	$(F90) $(F90FLAGS) -c -I $(OBJ_PATH) $<	
